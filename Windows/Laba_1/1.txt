@echo off
setlocal enabledelayedexpansion

set count=0

for /f "usebackq delims=" %%i in (`dir /b /ad "%dir%"`) do (
  if not "%%i"=="." if not "%%i"==".." (
    set "subdir=!dir!\%%i"
    if not exist "!subdir!\nul" (
      set /a count+=1
      call "%~f0" "!subdir!"
    )
  )
)

echo %count% directories found in %dir%

